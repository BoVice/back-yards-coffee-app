var editor=function(){function e(){if($("#zenpenbubble").length){lastRange=0,n();var e=document.createRange(),o=window.getSelection();o.removeAllRanges(),o.addRange(e),t()}}function t(){document.onkeyup=o,document.onmousedown=o,document.onmouseup=function(e){setTimeout(function(){o(e)},1)},window.addEventListener("resize",function(){i()});var e=!0;document.body.addEventListener("scroll",function(){if(e)return e=!0,i(),setTimeout(function(){e=!0},250)})}function n(){document.querySelector(".content"),S=document.querySelector(".text-options"),x=S.querySelector(".options"),(y=S.querySelector(".bold")).onclick=r,(b=S.querySelector(".italic")).onclick=d,(C=S.querySelector(".url")).onmousedown=m,(R=S.querySelector(".url-input")).onblur=p,R.onkeydown=f}function o(e){var t=window.getSelection();return"url-input"===e.target.className||"undefined"!=typeof e.target.classList&&e.target.classList.contains("url")?(w=s(t.focusNode),void c()):null!=e.target.parentNode.classList&&e.target.parentNode.classList.contains("ui-inputs")?(w=s(t.focusNode),void c()):(!0===t.isCollapsed&&!1===v&&a(),!1===t.isCollapsed&&(w=s(t.focusNode),1==u(t.focusNode)&&(c(),i(),S.className="text-options active")),void(v=t.isCollapsed))}function i(){var e=window.getSelection().getRangeAt(0).getBoundingClientRect();S.style.top=e.top-5+window.pageYOffset+"px",S.style.left=(e.left+e.right)/2+"px"}function c(){l(w,"B")?y.className="bold active":y.className="bold",l(w,"I")?b.className="italic active":b.className="italic",l(w,"A")?C.className="url useicons active":C.className="url useicons"}function a(){S.className="text-options fade",setTimeout(function(){"text-options fade"==S.className&&(S.className="text-options",S.style.top="-999px",S.style.left="-999px")},260)}function s(e){for(var t={};e.parentNode;)t[e.nodeName]=!0,"A"===(e=e.parentNode).nodeName&&(t.url=e.getAttribute("href"));return t}function u(e){for(;e.parentNode;){if(e.className!==undefined&&e.className.indexOf("phrasable")>=0&&e.className.indexOf("phrasable-on")>=0)return!0;e=e.parentNode}return!1}function l(e,t){return!!e[t]}function r(){document.execCommand("bold",!1)}function d(){document.execCommand("italic",!1)}function m(){"options"==x.className?(x.className="options url-mode",setTimeout(function(){var e=s(window.getSelection().focusNode);l(e,"A")?R.value=e.url:document.execCommand("createLink",!1,"/"),lastSelection=window.getSelection().getRangeAt(0),v=!1,R.focus()},100)):x.className="options"}function f(e){13===e.keyCode&&(e.preventDefault(),N(R.value),R.blur())}function p(){x.className="options",N(R.value),R.value="",w=s(window.getSelection().focusNode),c()}function N(e){g(),document.execCommand("unlink",!1),""!==e&&document.execCommand("createLink",!1,e)}function g(){window.getSelection().removeAllRanges(),window.getSelection().addRange(lastSelection)}var v,w,S,x,y,b,C,R;return{init:e}}();